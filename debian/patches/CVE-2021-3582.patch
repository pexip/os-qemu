
CVE-2021-3582

--- qemu-3.1+dfsg.orig/hw/rdma/vmw/pvrdma_cmd.c
+++ qemu-3.1+dfsg/hw/rdma/vmw/pvrdma_cmd.c
@@ -39,6 +39,14 @@ static void *pvrdma_map_to_pdir(PCIDevic
         return NULL;
     }
 
+    length = ROUND_UP(length, TARGET_PAGE_SIZE);
+    if (nchunks * TARGET_PAGE_SIZE != length) {
+        rdma_error_report("Invalid nchunks/length (%u, %lu)", nchunks,
+                          (unsigned long)length);
+        return NULL;
+    }
+
+
     dir = rdma_pci_dma_map(pdev, pdir_dma, TARGET_PAGE_SIZE);
     if (!dir) {
         error_report("PVRDMA: Failed to map to page directory");
