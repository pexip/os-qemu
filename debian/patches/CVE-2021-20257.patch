From: Markus Koschany <apo@debian.org>
Date: Sat, 10 Apr 2021 16:31:08 +0200
Subject: CVE-2021-20257

Bug-Debian: https://bugs.debian.org/984450
Origin: https://git.qemu.org/?p=qemu.git;a=commit;h=3de46e6fc489c52c9431a8a832ad8170a7569bd8
---
 hw/net/e1000.c | 4 ++++
 1 file changed, 4 insertions(+)

--- a/hw/net/e1000.c
+++ b/hw/net/e1000.c
@@ -657,6 +657,9 @@ process_tx_desc(E1000State *s, struct e1
         msh = tp->tso_props.hdr_len + tp->tso_props.mss;
         do {
             bytes = split_size;
+            if (tp->size >= msh) {
+                goto eop;
+            }
             if (tp->size + bytes > msh)
                 bytes = msh - tp->size;
 
@@ -682,6 +685,7 @@ process_tx_desc(E1000State *s, struct e1
         tp->size += split_size;
     }
 
+eop:
     if (!(txd_lower & E1000_TXD_CMD_EOP))
         return;
     if (!(tp->cptse && tp->size < tp->tso_props.hdr_len)) {
