
CVE-2021-3682

--- qemu-3.1+dfsg.orig/hw/usb/redirect.c
+++ qemu-3.1+dfsg/hw/usb/redirect.c
@@ -458,7 +458,7 @@ static int bufp_alloc(USBRedirDevice *de
     if (dev->endpoint[EP2I(ep)].bufpq_dropping_packets) {
         if (dev->endpoint[EP2I(ep)].bufpq_size >
                 dev->endpoint[EP2I(ep)].bufpq_target_size) {
-            free(data);
+            free(free_on_destroy);
             return -1;
         }
         dev->endpoint[EP2I(ep)].bufpq_dropping_packets = 0;
